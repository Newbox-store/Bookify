<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookify | منصة الناشرين الاحترافية</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --bg-card: #161616;
            --gold: #D4AF37;
            --gold-hover: #F9E076;
            --text-cream: #F5F5F5;
            --text-muted: #888888;
            --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--bg-dark); color: var(--text-cream); }

        /* الهيدر */
        nav {
            height: 90px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 7%; background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(15px);
            position: fixed; width: 100%; top: 0; z-index: 1000; border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }
        .logo { font-size: 2.2rem; font-weight: 900; color: var(--gold); }

        .btn-auth {
            background: transparent; color: var(--gold); border: 2px solid var(--gold);
            padding: 10px 25px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: var(--transition);
        }

        /* البانر الرئيسي */
        .hero {
            height: 100vh; display: flex; align-items: center; padding: 0 7%;
            background: radial-gradient(circle at top left, #1a1a1a 0%, #0a0a0a 100%);
        }
        .hero-content h1 { font-size: 4rem; margin-bottom: 25px; }
        .hero-content h1 span { color: var(--gold); }
        .btn-main {
            background: linear-gradient(45deg, var(--gold), var(--gold-hover));
            color: #000; padding: 18px 45px; border-radius: 12px; font-size: 1.2rem;
            font-weight: 900; border: none; cursor: pointer; transition: var(--transition);
        }

        /* لوحة التحكم */
        #dashboard { display: none; padding-top: 120px; min-height: 100vh; }
        .dashboard-grid { display: grid; grid-template-columns: 320px 1fr; gap: 30px; padding: 0 7%; }

        .sidebar { background: var(--bg-card); border-radius: 24px; padding: 40px 20px; border: 1px solid #222; text-align: center; }
        .profile-img { width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 20px; }

        .paywall-content { background: var(--bg-card); border-radius: 24px; padding: 60px; text-align: center; border: 1px dashed var(--gold); }
        .whatsapp-btn { display: inline-block; background: #25D366; color: white; padding: 18px 35px; border-radius: 12px; font-weight: 700; text-decoration: none; margin-top: 20px; }

        /* نموذج الإضافة */
        #activeContent { display: none; }
        .share-box { background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 1px solid var(--gold); }
        .book-form-card { background: var(--bg-card); padding: 30px; border-radius: 20px; border: 1px solid #333; margin-bottom: 30px; }
        .book-form-card input, .book-form-card textarea {
            width: 100%; padding: 15px; margin-bottom: 15px; background: #000; border: 1px solid #333; color: white; border-radius: 10px; font-family: 'Tajawal';
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo">Bookify</div>
        <button class="btn-auth" id="loginBtn">تسجيل الدخول</button>
    </nav>

    <section class="hero" id="heroSection">
        <div class="hero-content">
            <h1>حوّل كتبك إلى <br><span>تجارة ذهبية</span></h1>
            <p style="color: var(--text-muted); margin-bottom: 30px;">انضم لـ Bookify وابدأ بيع كتبك عبر مكتبتك الخاصة اليوم.</p>
            <button class="btn-main" onclick="signIn()">سجل الآن مجاناً</button>
        </div>
    </section>

    <section id="dashboard">
        <div class="dashboard-grid">
            <aside class="sidebar">
                <img id="uImg" src="" class="profile-img">
                <div id="uName" class="user-name" contenteditable="true" onblur="updateName()">USER1287</div>
                <div id="uEmail" style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 20px;"></div>
                <div id="statusLabel" style="color: var(--gold);">الحساب: قيد الانتظار</div>
            </aside>

            <main>
                <div class="paywall-content" id="paywallArea">
                    <i class="fas fa-lock" style="font-size: 3rem; color: var(--gold); margin-bottom: 20px;"></i>
                    <h2>بانتظار تفعيل الاشتراك</h2>
                    <p>تواصل معنا لتفعيل حسابك والبدء في رفع الكتب.</p>
                    <a href="https://wa.me/249122892258" class="whatsapp-btn"><i class="fab fa-whatsapp"></i> تواصل عبر واتساب</a>
                </div>

                <div id="activeContent">
                    <div class="share-box">
                        <h4 style="margin-bottom: 10px;">رابط مكتبتك للنشر:</h4>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="myStoreLink" readonly style="flex: 1; background: #000; color: var(--gold); border: none; padding: 10px; border-radius: 5px;">
                            <button class="btn-auth" onclick="copyLink()">نسخ</button>
                        </div>
                    </div>

                    <div class="book-form-card">
                        <h3 style="margin-bottom: 20px; color: var(--gold);">+ إضافة كتاب جديد</h3>
                        <input type="text" id="title" placeholder="عنوان الكتاب">
                        <input type="number" id="price" placeholder="السعر (ج.س)">
                        <input type="text" id="cover" placeholder="رابط صورة الغلاف">
                        <textarea id="desc" rows="3" placeholder="وصف الكتاب"></textarea>
                        <button class="btn-main" style="width: 100%;" onclick="addBook()">نشر الكتاب</button>
                    </div>
                </div>
            </main>
        </div>
    </section>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB95xhEp4Ssa4DqOPt9_FP7J8ETizhdh-I",
            authDomain: "bookify-bfe88.firebaseapp.com",
            projectId: "bookify-bfe88",
            storageBucket: "bookify-bfe88.firebasestorage.app",
            messagingSenderId: "852922537250",
            appId: "1:852922537250:web:aa12b414eb2f156b8dc17b"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        async function signIn() {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
        console.log("جاري محاولة تسجيل الدخول...");
        const result = await auth.signInWithPopup(provider);
        alert("نجح الاتصال بـ Firebase! أهلاً " + result.user.displayName);
    } catch (error) {
        // هذه هي أهم رسالة ستظهر على شاشة هاتفك
        alert("حدث خطأ! السبب:\n" + error.message);
        console.log("كود الخطأ: ", error.code);
    }
}


        document.getElementById('loginBtn').onclick = () => {
            if(auth.currentUser) auth.signOut().then(() => location.reload());
            else signIn();
        };

        auth.onAuthStateChanged(async (user) => {
    if (user) {
        // إظهار اللوحة فوراً لتجنب التعليق
        document.getElementById('heroSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        const userRef = db.collection('users').doc(user.uid);
        
        try {
            const doc = await userRef.get();
            if(!doc.exists) {
                // محاولة إنشاء المستند
                await userRef.set({
                    name: user.displayName,
                    email: user.email,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("تم إنشاء ملفك الشخصي بنجاح!");
            } else {
                // إذا كان الحساب موجوداً، حدث البيانات المعروضة
                const data = doc.data();
                document.getElementById('uName').innerText = data.name || user.displayName;
                document.getElementById('uImg').src = user.photoURL;
                document.getElementById('uEmail').innerText = user.email;
                
                if(data.status === 'active') {
                    document.getElementById('paywallArea').style.display = 'none';
                    document.getElementById('activeContent').style.display = 'block';
                    document.getElementById('statusLabel').innerText = "الحساب: عضوية ملكية";
                    document.getElementById('myStoreLink').value = window.location.origin + window.location.pathname.replace('index.html','') + 'store.html?id=' + user.uid;
                }
            }
        } catch (error) {
            console.error("خطأ Firestore:", error);
            alert("فشل تحديث البيانات من Firestore: " + error.message);
        }
    }
});


        async function addBook() {
            const t = document.getElementById('title').value;
            const p = document.getElementById('price').value;
            if(!t || !p) return alert("املأ البيانات");
            await db.collection('books').add({
                uid: auth.currentUser.uid,
                title: t,
                price: p,
                cover: document.getElementById('cover').value,
                desc: document.getElementById('desc').value,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("تم النشر!");
            location.reload();
        }

        function copyLink() {
            const copyText = document.getElementById("myStoreLink");
            copyText.select();
            document.execCommand("copy");
            alert("تم النسخ بنجاح!");
        }
    </script>
</body>
</html>
